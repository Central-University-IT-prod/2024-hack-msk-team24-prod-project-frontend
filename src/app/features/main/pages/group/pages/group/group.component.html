@if (group() !== null) {
  <div class="container">
    <p class="title">{{ group()!.title }}</p>

    <!--     bubbles -->
    @if (group()!.type !== 'equal') {
      <div class="bubbles">
        <button [class.chosen]="activePage === 'payment'" (click)="activePage = 'payment'">Оплата</button>
        <button [class.chosen]="activePage === 'bills'" (click)="activePage = 'bills'">Счета</button>
        @if (group()?.type === 'group') {
          <button [class.chosen]="activePage === 'create'" (click)="activePage = 'create'">Создать счет</button>
        }
      </div>
    }

    <div class="content">
      @switch (activePage) {
        @case ('payment') {
          <div class="payment-container">
            <p>Ваш долг: {{ allDebt }}₽</p>

            <div class="label">
              <p>Сколько вы готовы заплатить?</p>
              <label>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M20.2467 1.19266L20.4702 0.969157C20.6384 0.801032 20.8381 0.667687 21.0579 0.576736C21.2776 0.485786 21.5132 0.43901 21.751 0.439079C21.9888 0.439149 22.2243 0.486063 22.444 0.577142C22.6637 0.668222 22.8633 0.801683 23.0315 0.969907C23.1996 1.13813 23.3329 1.33782 23.4239 1.55758C23.5148 1.77733 23.5616 2.01285 23.5616 2.25069C23.5615 2.48852 23.5146 2.72401 23.4235 2.94372C23.3324 3.16342 23.1989 3.36303 23.0307 3.53116L22.8072 3.75316C23.1896 4.18195 23.3934 4.74075 23.3769 5.315C23.3605 5.88925 23.125 6.43546 22.7187 6.84166L7.28072 22.2812C7.18422 22.3772 7.0634 22.4451 6.93122 22.4777L0.931224 23.9777C0.805663 24.0089 0.674148 24.0072 0.549463 23.9726C0.424779 23.938 0.311166 23.8717 0.21967 23.7802C0.128173 23.6887 0.0619052 23.5751 0.0273071 23.4504C-0.00729101 23.3257 -0.0090421 23.1942 0.022224 23.0687L1.52222 17.0687C1.55504 16.937 1.62295 16.8168 1.71872 16.7207L16.1817 2.25766C16.0371 2.15585 15.8611 2.10845 15.6849 2.12382C15.5087 2.13919 15.3436 2.21634 15.2187 2.34166L10.2807 7.28116C10.211 7.35089 10.1282 7.4062 10.0371 7.44394C9.94599 7.48168 9.84834 7.50111 9.74972 7.50111C9.65111 7.50111 9.55346 7.48168 9.46235 7.44394C9.37124 7.4062 9.28846 7.35089 9.21872 7.28116C9.14899 7.21143 9.09368 7.12864 9.05594 7.03753C9.0182 6.94642 8.99878 6.84877 8.99878 6.75016C8.99878 6.65154 9.0182 6.55389 9.05594 6.46278C9.09368 6.37167 9.14899 6.28889 9.21872 6.21916L14.1597 1.28116C14.5662 0.874679 15.1128 0.639188 15.6874 0.62301C16.262 0.606831 16.821 0.811193 17.2497 1.19416C17.6619 0.825815 18.1952 0.622075 18.7479 0.621798C19.3007 0.621521 19.8342 0.824728 20.2467 1.19266Z"
                        fill="white"/>
                </svg>

                <input (input)="inputAmountToPatHandler($event)" [max]="allDebt" autocomplete="off" type="number"
                       name="group-name"
                       placeholder="Enter the amount">
              </label>
            </div>

            <button (click)="getPayUrl()" class="solid-button btn" style="max-width: 500px; margin-top: 20px;">
              <p>Заплатить</p>
            </button>
          </div>
        }
        @case ('bills') {
          <ul class="groups-list">
            @for (bill of bills; track bills) {
              <li (click)="router.navigate(['/home/group/'+group()?.id+'/bill/'+bill.id])" class="group-item">
                <span class="group-name">{{ bill.title }}</span>
                <span class="group-money">{{ bill.type }}</span>
              </li>
            } @empty {
              <p>В группе пока что ещё нет счетов</p>
            }
          </ul>
        }
        @case ('join') {
        }
        @default {
          <div class="label">
            <p>Название счета</p>
            <label>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M20.2467 1.19266L20.4702 0.969157C20.6384 0.801032 20.8381 0.667687 21.0579 0.576736C21.2776 0.485786 21.5132 0.43901 21.751 0.439079C21.9888 0.439149 22.2243 0.486063 22.444 0.577142C22.6637 0.668222 22.8633 0.801683 23.0315 0.969907C23.1996 1.13813 23.3329 1.33782 23.4239 1.55758C23.5148 1.77733 23.5616 2.01285 23.5616 2.25069C23.5615 2.48852 23.5146 2.72401 23.4235 2.94372C23.3324 3.16342 23.1989 3.36303 23.0307 3.53116L22.8072 3.75316C23.1896 4.18195 23.3934 4.74075 23.3769 5.315C23.3605 5.88925 23.125 6.43546 22.7187 6.84166L7.28072 22.2812C7.18422 22.3772 7.0634 22.4451 6.93122 22.4777L0.931224 23.9777C0.805663 24.0089 0.674148 24.0072 0.549463 23.9726C0.424779 23.938 0.311166 23.8717 0.21967 23.7802C0.128173 23.6887 0.0619052 23.5751 0.0273071 23.4504C-0.00729101 23.3257 -0.0090421 23.1942 0.022224 23.0687L1.52222 17.0687C1.55504 16.937 1.62295 16.8168 1.71872 16.7207L16.1817 2.25766C16.0371 2.15585 15.8611 2.10845 15.6849 2.12382C15.5087 2.13919 15.3436 2.21634 15.2187 2.34166L10.2807 7.28116C10.211 7.35089 10.1282 7.4062 10.0371 7.44394C9.94599 7.48168 9.84834 7.50111 9.74972 7.50111C9.65111 7.50111 9.55346 7.48168 9.46235 7.44394C9.37124 7.4062 9.28846 7.35089 9.21872 7.28116C9.14899 7.21143 9.09368 7.12864 9.05594 7.03753C9.0182 6.94642 8.99878 6.84877 8.99878 6.75016C8.99878 6.65154 9.0182 6.55389 9.05594 6.46278C9.09368 6.37167 9.14899 6.28889 9.21872 6.21916L14.1597 1.28116C14.5662 0.874679 15.1128 0.639188 15.6874 0.62301C16.262 0.606831 16.821 0.811193 17.2497 1.19416C17.6619 0.825815 18.1952 0.622075 18.7479 0.621798C19.3007 0.621521 19.8342 0.824728 20.2467 1.19266Z"
                      fill="white"/>
              </svg>

              <input [(ngModel)]="newBill.title" autocomplete="off" type="text" name="group-name"
                     placeholder="Enter bill name">
            </label>
          </div>

          <div style="margin: 20px 0;" class="label">
            <p>Тип счета</p>

            <select [(ngModel)]="newBill.type">
              <option value="equal">равный</option>
              <option value="nonequal">неравный</option>
            </select>
          </div>

          @if (newBill.type === 'nonequal') {
            <div style="max-width: 500px; margin: 10px 0;">
              <p>QR-код</p>
              <div class="photo-uploader">
                <label class="custom-file-upload">
                  <input type="file" accept="image/*" (change)="onFileSelected($event)" capture="camera"/>
                  Upload or Take a Photo
                </label>
                @if (newBill.products.length > 0) {
                  <div class="preview">
                    <h3>Ваши продукты:</h3>
                    <div class="products">
                      @for (product of newBill.products; track newBill.products) {
                        <div class="product">
                          <p>{{ product.name }}</p>
                          <div class="info">
                            <p>{{ product.price }}₽</p>

                            <p>{{ product.quantity }}</p>

                            <svg (click)="remove(product)" width="20" height="23" viewBox="0 0 20 23"
                                 xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M1.75 1.5C1.35218 1.5 0.970644 1.65804 0.68934 1.93934C0.408035 2.22064 0.25 2.60218 0.25 3V4.5C0.25 4.89782 0.408035 5.27936 0.68934 5.56066C0.970644 5.84196 1.35218 6 1.75 6H2.5V19.5C2.5 20.2956 2.81607 21.0587 3.37868 21.6213C3.94129 22.1839 4.70435 22.5 5.5 22.5H14.5C15.2956 22.5 16.0587 22.1839 16.6213 21.6213C17.1839 21.0587 17.5 20.2956 17.5 19.5V6H18.25C18.6478 6 19.0294 5.84196 19.3107 5.56066C19.592 5.27936 19.75 4.89782 19.75 4.5V3C19.75 2.60218 19.592 2.22064 19.3107 1.93934C19.0294 1.65804 18.6478 1.5 18.25 1.5H13C13 1.10218 12.842 0.720644 12.5607 0.43934C12.2794 0.158035 11.8978 0 11.5 0L8.5 0C8.10218 0 7.72064 0.158035 7.43934 0.43934C7.15804 0.720644 7 1.10218 7 1.5H1.75ZM6.25 7.5C6.44891 7.5 6.63968 7.57902 6.78033 7.71967C6.92098 7.86032 7 8.05109 7 8.25V18.75C7 18.9489 6.92098 19.1397 6.78033 19.2803C6.63968 19.421 6.44891 19.5 6.25 19.5C6.05109 19.5 5.86032 19.421 5.71967 19.2803C5.57902 19.1397 5.5 18.9489 5.5 18.75V8.25C5.5 8.05109 5.57902 7.86032 5.71967 7.71967C5.86032 7.57902 6.05109 7.5 6.25 7.5ZM10 7.5C10.1989 7.5 10.3897 7.57902 10.5303 7.71967C10.671 7.86032 10.75 8.05109 10.75 8.25V18.75C10.75 18.9489 10.671 19.1397 10.5303 19.2803C10.3897 19.421 10.1989 19.5 10 19.5C9.80109 19.5 9.61032 19.421 9.46967 19.2803C9.32902 19.1397 9.25 18.9489 9.25 18.75V8.25C9.25 8.05109 9.32902 7.86032 9.46967 7.71967C9.61032 7.57902 9.80109 7.5 10 7.5ZM14.5 8.25C14.5 8.05109 14.421 7.86032 14.2803 7.71967C14.1397 7.57902 13.9489 7.5 13.75 7.5C13.5511 7.5 13.3603 7.57902 13.2197 7.71967C13.079 7.86032 13 8.05109 13 8.25V18.75C13 18.9489 13.079 19.1397 13.2197 19.2803C13.3603 19.421 13.5511 19.5 13.75 19.5C13.9489 19.5 14.1397 19.421 14.2803 19.2803C14.421 19.1397 14.5 18.9489 14.5 18.75V8.25Z"/>
                            </svg>
                          </div>
                        </div>
                      }
                    </div>
                  </div>
                }
              </div>
            </div>
          } @else if (newBill.type === 'equal') {
            <div class="label">
              <p>Сумма счета</p>
              <label>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M20.2467 1.19266L20.4702 0.969157C20.6384 0.801032 20.8381 0.667687 21.0579 0.576736C21.2776 0.485786 21.5132 0.43901 21.751 0.439079C21.9888 0.439149 22.2243 0.486063 22.444 0.577142C22.6637 0.668222 22.8633 0.801683 23.0315 0.969907C23.1996 1.13813 23.3329 1.33782 23.4239 1.55758C23.5148 1.77733 23.5616 2.01285 23.5616 2.25069C23.5615 2.48852 23.5146 2.72401 23.4235 2.94372C23.3324 3.16342 23.1989 3.36303 23.0307 3.53116L22.8072 3.75316C23.1896 4.18195 23.3934 4.74075 23.3769 5.315C23.3605 5.88925 23.125 6.43546 22.7187 6.84166L7.28072 22.2812C7.18422 22.3772 7.0634 22.4451 6.93122 22.4777L0.931224 23.9777C0.805663 24.0089 0.674148 24.0072 0.549463 23.9726C0.424779 23.938 0.311166 23.8717 0.21967 23.7802C0.128173 23.6887 0.0619052 23.5751 0.0273071 23.4504C-0.00729101 23.3257 -0.0090421 23.1942 0.022224 23.0687L1.52222 17.0687C1.55504 16.937 1.62295 16.8168 1.71872 16.7207L16.1817 2.25766C16.0371 2.15585 15.8611 2.10845 15.6849 2.12382C15.5087 2.13919 15.3436 2.21634 15.2187 2.34166L10.2807 7.28116C10.211 7.35089 10.1282 7.4062 10.0371 7.44394C9.94599 7.48168 9.84834 7.50111 9.74972 7.50111C9.65111 7.50111 9.55346 7.48168 9.46235 7.44394C9.37124 7.4062 9.28846 7.35089 9.21872 7.28116C9.14899 7.21143 9.09368 7.12864 9.05594 7.03753C9.0182 6.94642 8.99878 6.84877 8.99878 6.75016C8.99878 6.65154 9.0182 6.55389 9.05594 6.46278C9.09368 6.37167 9.14899 6.28889 9.21872 6.21916L14.1597 1.28116C14.5662 0.874679 15.1128 0.639188 15.6874 0.62301C16.262 0.606831 16.821 0.811193 17.2497 1.19416C17.6619 0.825815 18.1952 0.622075 18.7479 0.621798C19.3007 0.621521 19.8342 0.824728 20.2467 1.19266Z"
                        fill="white"/>
                </svg>

                <input (input)="oneProductBillInputSum($event)" autocomplete="off" type="text" name="group-name"
                       placeholder="Enter bill name">
              </label>
            </div>
          }

          @if (error) {
            <div class="error-container">
              <p>Ошибка</p>
              <p>{{ error }}</p>
            </div>
          }

          <button (click)="createNewBill()" class="solid-button btn" style="max-width: 500px; margin-top: 20px;">
            <p>Create</p>
            <svg width="33" height="11" viewBox="0 0 33 11" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1.83334 5.5L31.1667 5.5M31.1667 5.5L27.1667 1.5M31.1667 5.5L27.1667 9.5" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        }
      }
    </div>
  </div>
} @else {
  <!-- loader -->
  <div class="loader-container">
    <div class="loader" title="0">
      <svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg"
           x="0px" y="0px"
           width="40px" height="40px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve">
  <path opacity="0.2" fill="#000" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946
    s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634
    c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"/>
        <path fill="#000" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0
    C22.32,8.481,24.301,9.057,26.013,10.047z">
    <animateTransform attributeType="xml"
                      attributeName="transform"
                      type="rotate"
                      from="0 20 20"
                      to="360 20 20"
                      dur="0.5s"
                      repeatCount="indefinite"/>
    </path>
  </svg>
    </div>
  </div>
}
